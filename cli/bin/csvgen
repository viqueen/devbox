#!/usr/bin/env node

const { Command } = require("commander");
const Chance = require("chance");

const program = new Command();
const chance = new Chance();

program.option("-c, --count <count>", "with count", "100");
program.option("-h, --headers <headers>", "with headers", "");
program.option("-v, --values <values>", "with constant values", "");
program.action((opts) => {
  const count = parseInt(opts.count);
  const headers = opts.headers.trim().split(",");
  const values = opts.values.trim().split(",");

  const valueMap = values.reduce((map, current) => {
    const [key, value] = current.split("=");
    map[key] = value;
    return map;
  }, {});

  console.info(headers.join(","));
  for (let index = 0; index < count; index++) {
    const row = [];
    headers.forEach((header) => {
      const data = valueMap[header] ?? chance.guid();
      row.push(data);
    });
    console.info(row.join(","));
  }
});

program.version("1.0.0");
program.parse(process.argv);
