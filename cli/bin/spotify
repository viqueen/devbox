#! /usr/bin/env node

const dotenv = require('dotenv');
const axios = require('axios');
const qs = require('querystring');
const AxiosCli = require('../lib/axios-cli');

const axiosCli = new AxiosCli({
    baseURL: `https://api.spotify.com/v1`,
    name: 'Spotify API',
    auth: {
        bearerToken: async () => {
            const clientId = dotenv.config().parsed?.SPOTIFY_CLIENT_ID;
            const clientSecret = dotenv.config().parsed?.SPOTIFY_CLIENT_SECRET;
            const client = axios.create({
                baseURL: 'https://accounts.spotify.com',
                auth: {
                    username: clientId,
                    password: clientSecret
                }
            });
            const response = await client.request({
                url: '/api/token',
                method: 'POST',
                headers: { 'content-type': 'application/x-www-form-urlencoded' },
                data: qs.stringify({ grant_type: 'client_credentials' })
            });
            // noinspection JSUnresolvedVariable
            return response.data.access_token;
        }
    }
});

const program = axiosCli.program();

program.version('1.0.0');
program.parse(process.argv);
