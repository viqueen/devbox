#! /usr/bin/env node

const AxiosCli = require('../lib/axios-cli');
const AxiosOauthClient = require('../lib/axios-oauth-client');
const dotenv = require('dotenv');
const path = require('path');

const config = dotenv.config({
    path: path.resolve(process.env.VIQUEEN_DEVBOX_HOME, '.env')
}).parsed;

const oauthClient = new AxiosOauthClient({
    name: 'Spotify',
    authorizeUrl: 'https://accounts.spotify.com/authorize',
    grantUrl: 'https://accounts.spotify.com/api/token',
    clientId: config.SPOTIFY_CLIENT_ID,
    clientSecret: config.SPOTIFY_CLIENT_SECRET,
    scopes: ['user-read-recently-played']
});

const mySpotifyCli = new AxiosCli({
    name: 'Spotify API / ME',
    baseURL: 'https://api.spotify.com/v1/me',
    auth: {
        bearerToken: async () => {
            return await oauthClient.accessToken();
        }
    },
    headers: {
        'Content-Type': 'application/json'
    }
})

const program = mySpotifyCli.program();
program
    .command('login')
    .description('oauth login flow')
    .action(async () => {
        await oauthClient.login();
        process.exit();
    });
program.version('1.0.0');
program.parse(process.argv);