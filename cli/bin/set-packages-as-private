#! /usr/bin/env node

const minimist = require("minimist");
const path = require("path");
const fs = require('fs');
const {listFiles} = require("fs-directory");
const argv = minimist(process.argv.slice(2));

if (argv._.length === 0) {
    console.log('needs explicit directories, will not run on cwd');
    return 1;
}

const setAsPrivate = (filename) => {
    console.log(`** process: `, filename);
    const data = fs.readFileSync(filename).toString();
    const packageInfo = JSON.parse(data);
    packageInfo['private'] = true;
    fs.writeFileSync(filename, JSON.stringify(packageInfo, null, 2));
}

const directories = argv._.map(item => path.resolve(process.cwd(), item));
const packages = directories.flatMap(directory => listFiles(directory, {
    fileFilter: (entry) => entry.name === 'package.json',
    directoryFilter: () => true
}))

packages.forEach(setAsPrivate);
